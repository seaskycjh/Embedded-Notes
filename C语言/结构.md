## 结构体

[TOC]

------

结构是一个或多个变量的集合，这些变量可以是不同的类型。

### 1 结构体

关键字struct引入结构声明，其后的名字是可选的，称为结构标记，用于为结构命名。结构声明由包含在花括号内的一系列声明组成，结构中定义的变量称为成员。标志结构成员表结束的右花括号之后可以跟一个变量表，用于声明结构变量。

### 2 枚举类型

**枚举（Enum）类型**能够列出所有可能的取值，并给它们取一个名字。

```c
/* 列出一个星期的天数 */
enum week{ Mon, Tues, Wed, Thurs, Fri, Sat, Sun } a;
a = Mon;  //给枚举变量赋值
printf("%d %d", sizeof(Mon), sizeof(a));  //结果为: 4 4
/* 只给第一个名字指定值，枚举值就从 1 开始递增 */
enum week{ Mon = 1, Tues, Wed, Thurs, Fri, Sat, Sun };
```

枚举值默认从 0 开始，往后逐个加 1（递增）。也可以给每个名字都指定一个值或者只给一个名字指定值。

枚举类型的元素都是常量，不能对它们赋值。

宏在预处理阶段将名字替换成对应的值，枚举在编译阶段将名字替换成对应的值。我们可以将枚举理解为编译阶段的宏。

### 3 共用体

结构体和共用体的区别在于：结构体的各个成员会占用不同的内存，互相之间没有影响；而共用体的所有成员占用同一段内存，修改一个成员会影响其余所有成员。

**注意**：共用体占用的内存等于最长的成员占用的内存。共用体使用了内存覆盖技术，同一时刻只能保存一个成员的值，如果对新的成员赋值，就会把原来成员的值覆盖掉。

```c
union data{
    int n;
    char ch;
    float f;
} a;
union data b;
a.n = 65;
printf("%d %c %f", a.n, a.ch, a.f);
//输出为65 A 0.000000
```

### 4 位域

#### 4.1 简介

在结构体定义时，我们可以指定某个成员变量所占用的二进制位数（Bit），这就是**位域**。

C语言标准规定，位域的宽度不能超过它所依附的数据类型的长度。

#### 4.2 位域的存储

1) 当相邻成员的类型相同时，如果它们的位宽之和小于类型所占字节数，那么后面的成员紧邻前一个成员存储，直到不能容纳为止；如果它们的位宽之和大于类型所占字节数，那么后面的成员将从新的存储单元开始，其偏移量为类型大小的整数倍。

2) 当相邻成员的类型不同时，GCC 会进行压缩，成员挨着存储；而 VC/VS 不会，成员按照各自的类型存储（与不指定位宽时的存储方式相同）。

3) 如果成员之间穿插着非位域成员，那么不会进行压缩。

```c
int main()
{
    /* 相邻成员类型相同 */
    struct bs1{
        int a: 6;
        int b: 12;
        int c: 4;
    };
    /* 相邻成员类型不同 */
    struct bs2{
        int a: 12;
        char b: 4;
        int c: 4;
    };
    /* 成员间穿插非位域成员 */
    struct bs1{
        int a: 6;
        int b;
        int c: 4;
    };
    printf("%d %d %d", sizeof(struct bs1), sizeof(struct bs2), sizeof(struct bs3));
    //输出结果为: 4 4(GCC)/12(VC) 12
}
```

#### 4.3 无名位域

位域成员可以没有名称，只给出数据类型和位宽。

```c
struct bs{
    int m: 12;
    int  : 20;  //该位域成员不能使用
    int n: 4;
};
```

无名位域一般用来作填充或者调整成员位置。