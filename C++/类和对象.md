## 类和对象

[TOC]

---

1 面向对象的程序设计

1.1 定义

- 将某类客观事物共同特点归纳出来，形成一个数据结构。
- 将事物能进行的行为归纳出来，形成一个个能够操作此数据结构的函数。
- 将数据结构和操作该数据结构的函数绑定在一起，形成一个类。



类的基本思想是数据抽象和封装。

**数据抽象**：依赖于**接口**（interface）和**实现**（implementation）分离的编程技术。类的接口包括用户所能执行的操作；类的实现包括类的数据成员、负责接口实现的函数体以及定义类所需的各种私有函数。

**封装**：实现了类的接口和实现的分离。封装后的类隐藏了它的实现细节，即类的用户只能使用接口而无法访问实现部分。

### 1 类的定义和对象的创建

类是创建对象的模板，一个类可以创建多个对象，每个对象都是类类型的一个变量（具体实例）。

类可以理解为一种新的数据类型。

#### 1.1 类的定义

使用class或struct关键字定义类。

**class**：默认访问权限为private。

**struct**：默认访问权限为public。

#### 1.2 对象的创建

#### 1.3 对象指针

在栈上创建出来的对象都有一个名字，使用指针指向它不是必须的。

使用 new 在堆上创建出来的对象是匿名的，没法直接使用，必须要用一个指针指向它，再借助指针来访问它的成员变量或成员函数。

栈内存是程序自动管理的，不能使用 delete 删除在栈上创建的对象；堆内存由程序员管理，对象使用完毕后可以通过 delete 删除。

### 2 类成员函数

#### 2.1 定义

在类体中直接定义函数时，不需要在函数名前面加上类名，因为函数属于哪一个类是不言而喻的。

但当成员函数定义在类外时，就必须在函数名前面加上类名予以限定。**::** 被称为**域解析符**（也称作用域运算符或作用域限定符），用来连接类名和函数名，指明当前函数属于哪个类。

#### 2.2 类中和类外定义成员函数的区别

在类体中定义的成员函数会自动成为内联函数，可以加 inline 关键字，但这是多余的。

在类体外定义的不会，因此最好在类体内部对成员函数作声明，而在类体外部进行定义。

### 3 类访问修饰符

使用访问说明符加强类的封装性：

**public**：成员在整个程序内可被访问，定义类的接口。

**private**：成员可被类的成员函数访问，但不能被使用该类的代码访问，封装了类的实现细节。

成员变量大都以`m_`开头，这是约定成俗的写法。

给成员变量赋值的函数通常称为 set 函数，它们的名字通常以 **set** 开头，后跟成员变量的名字；读取成员变量的值的函数通常称为 get 函数，它们的名字通常以 **get** 开头，后跟成员变量的名字。

### 4 构造/析构函数

#### 4.1 构造函数

类的**构造函数**是类的一种特殊的成员函数，它会在每次创建类的新对象时执行。

构造函数的名称与类的名称是完全相同的，并且不会返回任何类型，也不会返回 void。构造函数可用于为某些成员变量设置初始值。

**带参构造函数**：构造函数也可以带有参数。这样在创建对象时就会给对象赋初始值，

**构造函数初始化列表**：

初始化 const 成员变量的唯一方法就是使用初始化列表。

成员变量的初始化顺序与初始化列表中列出的变量的顺序无关，它只与成员变量在类中声明的顺序有关。

#### 4.2 析构函数

类的**析构函数**是类的一种特殊的成员函数，它会在每次删除所创建的对象时自动执行。

析构函数的名称与类的名称是完全相同的，只是在前面加了个波浪号（~）作为前缀，它不会返回任何值，也不能带有任何参数，因此不能被重载。

**执行时机**：析构函数在对象被销毁时调用，而对象的销毁时机与它所在的内存区域有关

- 全局对象：程序在结束执行时会调用这些对象的析构函数。
- 局部对象：函数执行结束时会调用这些对象的析构函数。
- new 创建的对象：通过 delete 删除时才会调用析构函数。

### 5 类的友元

类可以允许其他类或者函数访问它的非公有成员，方法是令其他类或函数成为它的**友元**（friend）。以friend关键字开始的函数声明语句即可。友元声明只能出现在类定义内部，最好在类定义开始或结束前集中声明。

#### 5.1 友元函数

友元函数可以是不属于任何类的非成员函数，也可以是其他类的成员函数。

**注意**：友元函数不同于类的成员函数，在友元函数中不能直接访问类的成员，必须要借助对象。

#### 5.2 友元类

友元类中的所有成员函数都是另外一个类的友元函数。

#### 5.3 友元关系

注意以下几点：

- 友元关系不能被继承。类A是类B的友元，类C是类A的公有派生类，则类C不一定是类B的友元。

- 友元关系是单向的，不具有交换性。类A是类B的友元，则类A不一定是类B的友元。

- 友元关系不具有传递性。类A是类B的友元,类C是类A的友元，则类C不一定是类B的友元。

### 6 类的内联函数

6.1 定义

如果一个函数是内联的，那么在编译时，编译器会把该函数的代码副本放置在每个调用该函数的地方。

如果想把一个函数定义为内联函数，则需要在函数名前面放置关键字 **inline**，在调用函数之前需要对函数进行定义。

在类定义中的定义的函数都是内联函数，即使没有使用 **inline** 说明符。

### 7 类的this指针

#### 7.1 简介

this 是C++中的一个关键字，也是一个 const指针，它指向当前对象，通过它可以访问当前对象的所有成员。所谓当前对象，是指正在使用的对象。this 只能用在类的内部。注意：

- this 是一个指针，要用 **->** 来访问成员变量或成员函数。
- this 是 const 指针，它的值是不能被修改的。

- this 只能在成员函数内部使用。
- 只有当对象被创建后 this 才有意义，因此不能在静态成员函数中使用。

#### 7.2 this的实质

this 实际上是成员函数的一个形参，在调用成员函数时将对象的地址作为实参传递给 this。不过 this 这个形参是隐式的，它并不出现在代码中。

this 作为隐式形参，本质上是成员函数的局部变量。

### 8 指向类的指针

### 9 类的静态成员

定义：与类本身直接相关的成员，而不是与类的各个对象保持关联。

#### 9.1 声明静态成员

通过在成员的声明之前加上关键字static使其与类关联在一起。类的静态成员存在于任何对象之外，对象中不包含任何与静态数据成员有关的数据。静态成员函数也不与任何对象绑定在一起，不包含this指针。

#### 9.2 访问静态成员

```
类名::成员名
对象名.成员名
指针->成员名
引用.成员名
```

#### 9.3 定义静态成员

既可以在类的内部也可以在类的外部定义静态成员函数。在类的外部定义静态成员时，不能重复static关键字，该关键字只能出现在类内部的声明语句。

静态数据成员不是在创建类的对象时被定义的，一般来说不能在类的内部初始化静态成员，必须在类的外部定义和初始化每个静态成员，一个静态数据成员只能定义一次。

### 10 类的const成员

**const成员变量**：初始化 const 成员变量只有一种方法，就是通过构造函数的初始化列表。

**const成员函数**：可以使用类中的所有成员变量，但是不能修改它们的值。常成员函数需要在声明和定义的时候在**函数头部的结尾**加上 const 关键字，必须在成员函数的声明和定义处同时加上 const 关键字。

------

**示例代码**：

```c++
#include <iostream>
using namespace std;

//声明Box类
class Box{
public:
    Box(int l, int w, int h) : length(l), width(w), height(h){
        //TODO;
    }
    //相当于
    Box(int l, int w, int h){
        length = l;
        width = w;
        height = h;
    }
    //将RedBox类声明为Box类的友元类
    friend class RedBox;
    //声明友元函数
    friend void printWidth(Box box);
    //声明常成员函数
    int getWidth() const;
private:
    int length;
    int width;
    int height;
}
//printWidth函数不是任何类的成员函数
void printWidth(Box box){
    cout << box.width << endl;
}
//定义常成员函数
int Box::getWidth() const{
    return width;
}
//声明RedBox类
class RedBox{
public:
    int getColor();
private:
    int color;
}
int main(void)
{
    Box box;
    Box *pBox = &box;  //栈上创建的对象的地址
    pBox = new Box;  //堆上创建的对象的地址
}
```

