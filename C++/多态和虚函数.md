多态和虚函数



1 简介

基类的指针也可以指向派生类对象，通过基类指针只能访问派生类的成员变量，但是不能访问派生类的成员函数。为了让基类指针能够访问派生类的成员函数，C++增加了**虚函数（Virtual Function）**。

有了虚函数，基类指针指向基类对象时就使用基类的成员（包括成员函数和成员变量），指向派生类对象时就使用派生类的成员。即基类指针具有多种形态，这种现象称为**多态（Polymorphism）**。

C++提供多态的目的是：可以通过基类指针对所有派生类（包括直接派生和间接派生）的成员变量和成员函数进行“全方位”的访问，虚函数是根据指针的指向来调用的，指针指向哪个类的对象就调用哪个类的虚函数。

2 注意事项

2.1 虚函数注意事项

- 将基类中的函数声明为虚函数，这样所有派生类中具有遮蔽关系的同名函数都将自动成为虚函数。
- 构造函数不能是虚函数。
- 只有派生类的虚函数覆盖基类的虚函数（函数原型相同）才能构成多态（通过基类指针访问派生类函数）。

- 析构函数可以声明为虚函数，而且有时候必须要声明为虚函数，

2.1 构成多态的条件

- 必须存在继承关系。
- 继承关系中必须有同名的虚函数，并且它们是覆盖关系（函数原型相同）。
- 存在基类的指针，通过该指针调用虚函数。

3 纯虚函数和抽象类

3.1 纯虚函数

将虚函数声明为纯虚函数，语法格式为：

`virtual 返回值类型 函数名(函数参数) = 0;`

包含纯虚函数的类称为抽象类（Abstract Class）。之所以说它抽象，是因为它无法实例化，也就是无法创建对象。

抽象类通常是作为基类，让派生类去实现纯虚函数。派生类必须实现纯虚函数才能被实例化。