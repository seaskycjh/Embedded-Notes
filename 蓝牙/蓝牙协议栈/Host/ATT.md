

2 协议概览

属性协议定义了两种角色：服务器（server）角色和客户端（client）角色。它允许服务器向客户端公开一组属性，客户端可以使用属性协议访问这些属性。

属性是一个离散值，有以下三个与它相关的属性：

- 属性类型，由 UUID 定义。
- 属性句柄。
- 属性权限。

客户端可以向服务器发送属性协议请求，服务器应响应所有接收到的请求。一个设备可以实现客户端和服务器两种角色，并且这两个角色可以在同一设备中并发工作。每个蓝牙设备上只有一个服务器实例，服务器可以支持多个客户端。

属性协议具有通知和指示功能，因此无需读取属性值就能向客户端发送属性值。

3 协议要求

3.1 简介

属性值使用其属性句柄访问。客户端使用属性协议 PDUs（协议数据单元）发现属性句柄。

3.2 基本概念

**属性类型**：通用唯一标示符（UUID）用于标识每种属性类型。UUID 在所有空间和时间中都是唯一的，可以由任何人创建，并根据需要发布。

**属性句柄**：一个 16 位的值，由服务器分配给它的属性，以允许客户端引用这些属性。

任何服务器上的属性句柄都应该有唯一的、非 0 的值，属性按属性句柄排序。

值为 0x0000 的属性句柄是保留的，不能使用，值为 0xFFFF 的属性句柄称为最大属性句柄。

属性句柄分组：

**属性值**：是一个长度固定或可变的字节数组。例如，它可以为 1 字节，或 4 字节的整数，或可变长度的字符串。如果属性值太大而不能在单个 PDU 中传输，则可使用多个 PDU 发送。值的传输对属性协议是不透明的，这些字节数组的编码由属性类型决定。

当发送请求、响应、通知或指示中的属性值时，属性值长度不发送到 PDU 的任何字段中，PDU 中可变长度字段的长度隐式地由携带该 PDU 的数据包的长度给出，这意味着：

- 在单个请求、响应、通知或指示中只能放置一个属性值。
- 此属性值是请求、响应、通知或指示中的唯一可变长度字段。
- 承载协议保持数据报边界。

**属性权限**：属性具有一组与其相关联的权限值。与属性相关联的权限可以指定读/写该属性，与属性相关联的权限指定了读/写/通知/指示所需的安全级别，给定属性的权限由更高层次的规范定义。

属性权限是访问权限、加密权限、身份权限和授权权限的组合。

访问权限：可读、可写、可读和可写。

加密权限：需要加密、无需加密。

身份权限：需要身份验证、无需身份验证。

服务器使用访问权限来确定客户端是否可以读/写属性值。

**控制点属性**：不能读取但可以写入、通知或指示的属性。这些属性可被高层用于启动设备的特定过程。

协议方法：属性协议利用这些方法来查找、读取、写入、通知和指示属性。

3.3 属性 PDU

属性 PDUs 是以下 6 种方法中的一种：

- 请求：客户端发送 PDUs 到服务器，并调用响应。
- 响应：服务器发送 PDUs 到客户端以响应其请求。
- 命令：客户端发送 PDUs 到服务器。
- 通知：服务器未收到请求而发送 PDUs 到客户端。
- 指示：服务器未收到请求而发送 PDUs 到客户端，并调用确认。
- 确认：客户端发送 PDUs 到服务器以确认收到了指示。

服务器能接收并响应下列请求：

- 查找信息请求。
- 读请求。

如果服务器接收到一个不支持的请求，则服务器应用错误代码来响应错误。

3.3.1 属性 PDU 格式



3.4 属性协议 PDUs

3.4.1 错误处理

错误响应：用于声明一个给定的请求不能执行，并提供原因。

3.4.2 MTU 交换

