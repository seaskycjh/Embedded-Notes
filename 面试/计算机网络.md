计算机网络

[TOC]

------

### 1 TCP/IP

#### 1.1 OSI七层模型

物理层：通过媒介传输比特（bit），确定机械及电气规范。

数据链路层：将比特组装成帧，点到点的传递。

网络层：负责数据包从源到宿的传递和网际互连。

传输层：提高端到端的可靠报文传递和错误恢复。

会话层：建立、管理和终止会话。

表示层：对数据进行翻译、加密和压缩。

应用层：允许访问OSI环境的手段。

#### 1.2 TCP/IP四层模型

网络接口层：

网络层：

传输层：

应用层：

#### 1.2 TCP数据包格式

1）源端口、目的端口：都为16位。标识出远端和本地的端口号。

2）序号：32位。标识发送的数据报的顺序。

3）确认号：32位。希望收到的下一个数据包的序列号。

4）TCP头长：4位。表明 TCP 头中包含多少个 32 位字。

保留：6位，必须为0。

URG：紧急标志位，置1说明紧急指针有效。

ACK：确认标志位，置1表明确认号是合法的。若ACK为0，则数据报不包含确认信息，确认字段被省略。

PSH：推标志位，置1表示接收方应立即请求将报文交给应用层；

RST：复位标志位，用于重建一个已经混乱的连接。

SYN：同步标志位，用于建立连接。

FIN：结束标志位，用于释放连接。

窗口大小：16位，表示在确认了字节之后还可以发送多少个字节。

5）校验和、紧急指针：都为16位。

6）可选项：0或多个32位字。

7）数据。

1.3 UDP数据报格式

1）源端口号、目的端口号：都为16位。

2）长度：16位，报头和数据两部分的总字节数。

校验和：16位。

3）数据。

#### 1.3 TCP如何保证可靠性

- 序列号、确认应答、超时重传。
- 窗口控制、高速重发控制。
- 拥塞控制：慢启动、拥塞避免、快速重传。

#### 1.4 TCP建立连接（三次握手）

seq：序号，ack：确认号。

- 客户端：调用connect函数，将标志位SYN置1，随机产生值seq=J，发送该数据包给服务器，进入阻塞状态。
- 服务器：将标志位SYN和ACK置1，ack=J+1，随机产生值seq=K，发送该数据包给客户端，进入阻塞状态。
- 客户端：将ACK置1，ack=K+1，发送该数据包给服务器，connect函数返回。服务器：连接成功，accept函数返回。

#### 1.5 TCP断开连接（四次挥手）

- 客户端：调用close函数主动关闭连接，将FIN置1，随机产生值seq=M，发送该数据包给服务器，进入阻塞状态。
- 服务器：将ACK置1，ack=M+1，发送该数据包给客户端。
- 服务器：调用close函数主动关闭连接，将FIN置1，随机产生值seq=N，发送该数据包给客户端，进入阻塞状态。
- 客户端：将ACK置1，ack=N+1，发送该数据包给服务器。

#### 1.6 基于TCP的套接字

**服务器**：

- 创建一个套接字描述符（socket）。
- 设置服务器的IP地址、端口号等信息。
- 将地址信息到socket上（bind）。
- 设置最大连接数（listen）。
- 接受客户端连接（accept）。
- 收发数据（send/recv、read/write）。
- 关闭连接（close）。

客户端：

- 创建一个套接字描述符（socket）。
- 设置要连接的服务器的IP地址和端口等属性。
- 连接到服务器（connect）。
- 收发数据（send/recv、read/write）。
- 关闭连接（close）。

#### 1.7 基于UDP的套接字

服务器：

- 创建一个套接字描述符（socket）。
- 设置服务器的IP地址、端口号等信息。
- 将地址信息到socket上（bind）。
- 发送/接收数据（sendto/recvfrom）。
- 关闭连接（close）。

客户端：

- 创建一个套接字描述符（socket）。
- 设置要连接的服务器的IP地址和端口等属性。

- 发送/接收数据（sendto/recvfrom）。
- 关闭连接（close）。

#### 1.8 TCP和UDP的区别

**连接性**：TCP是面向连接的，传输数据前要先建立连接。UDP是无连接的。

**可靠性**：TCP是可靠交付：保证数据无差错、不丢失、不重复、按序到达。UDP尽最大努力交付，不保证可靠交付。

**服务对象**：TCP是点对点的两点间服务。UDP支持一对一、一对多、多对一、多对多通信。

**首部开销**：TCP首部开销大（20字节）。UDP首部开销小（8字节）。

**适用场景**：TCP传输速度慢。UDP实时性好，工作效率高，传输速度快。

### 2 HTTP

#### 2.1 HTTP协议的特点

简单快速：客户端向服务器请求服务时，只需传送请求方法和路径。

灵活：允许传输任意类型的数据。由Content-Type加以标记。

无连接：每次连接只处理一个请求，服务器处理完客户端请求并收到应答后即断开连接。

无状态：对于事务处理没有记忆能力。

其他：默认端口80，基于TCP协议。

#### 2.2 GET和POST的区别

- get的参数通过url传递。post则放在请求正文中。因此get比post不安全。
- get传递的参数有长度限制。post没有。
- get请求只能进行url编码。post支持多种编码方式。
- get产生一个TCP数据包。post产生两个TCP数据包。