内存管理

[TOC]

------

1 无存储器抽象

最简单的存储器抽象就是根本没有抽象，每一个程序都直接访问物理内存。这种情况下，在内存中同时运行两个程序是不可能的。

但是，即使没有存储器抽象，同时运行多个程序也是可能的，操作系统只需把当前内存中的所有内容保存到磁盘文件中，然后把下一个程序读入到内存中再运行即可。

2 一种存储器抽象：地址空间

把物理空间暴露给进程会带来以下严重问题：

- 若用户程序可以寻址内存的每个字节，它们就可以很容易地破坏操作系统。
- 想要同时运行多个程序是很困难的。

2.1 地址空间概念

地址空间是一个进程可用于寻址内存的一套地址集合。每个进程都有一个自己的地址空间，且这个地址空间独立于其他进程的地址空间。

2.2 交换技术

把一个进程完整调入内存，使该进程运行一段时间，然后把它存回磁盘，空闲进程主要存储再磁盘，不占用内存。

2.3 空闲内存管理

在动态分配内存时，操作系统必须对其进行管理。一般而言有两种方法跟踪内存使用情况：位图和空闲区链表。

3 虚拟内存

计算机发展导致运行的程序往往大到内存无法容纳，而且需要操作系统支持多个程序同时运行。

**虚拟内存**（virtual memory）的基本思想是：每个程序拥有自己的地址空间，这个地址空间被分割为多个块。每个块称为一**页**或者**页面**（page）。每一页有连续的地址范围，这些页被映射到物理内存，但并不是所有的页都必须在内存中才能运行程序。

3.1 分页

由程序产生的地址称为**虚拟地址**（virtual address），它们构成了一个**虚拟地址空间**。在没有虚拟内存的情况下，系统直接将虚拟地址送到内存总线，读写具有同样地址的物理内存。在使用虚拟内存的情况下，虚拟地址被送到**内存管理单元**（Memory Management Unit，MMU），MMU把虚拟地址映射为物理内存地址。

3.2 页表

虚拟内存到物理地址的映射可以概括为：虚拟地址被分成虚拟页号（高位部分）和偏移量（低位部分）两部分。虚拟页号可用作页表的索引。页表的作用是把虚拟页面映射为页框。

注意：虚拟内存本质上是用来创造一个新的抽象概念：地址空间，而地址空间是对物理内存的抽象。类似于进程是对物理处理器的抽象。

4 页面置换算法

5 分页系统中的设计问题

5.1 共享页面

共享页面避免了在内存中有一个页面的两份副本，效率更高。不是所有页面都适合共享，只读页面（如程序文本）可以共享，但数据页面则不能共享。

5.2 共享库

5.3 内存映射文件